trigger:
  branches:
    include:
    - '*' 
  paths:
    exclude:
    - README.md

pr:
  branches:
    include:
    - '*' 
  paths:
    exclude:
    - README.md

stages:
- stage: Unit_Tests
  jobs:
  - job: Client
    pool:
      vmImage: 'ubuntu-latest'
    continueOnError: true
    workingDirectory: $(build.sourcesDirectory)/Services/TicketStore.Web/Client
    variables:
      CI: true
      npm_config_cache: $(Pipeline.Workspace)/.npm
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '10.x'
      displayName: 'Install Node.js'
    - task: CacheBeta@0
      inputs:
        key: npm | $(Agent.OS) | package-lock.json
        path: $(npm_config_cache)
      displayName: Cache npm
    - script: |
        npm install
      displayName: Install Dependencies
    - script: |
        npm run build
      displayName: 'npm build'
    - script: |
        npm test
      displayName: 'npm test'
    - task: PublishTestResults@2
      condition: always()
      inputs:
        testResultsFormat: 'JUnit' # Options: JUnit, NUnit, VSTest, xUnit, cTest
        testResultsFiles: 'reports/junit.xml' 
        # searchFolder: '$(build.sourcesDirectory)/Services/TicketStore.Web/Client' # Optional

  # - job: Api
  #   pool:
  #     vmImage: 'ubuntu-latest'
  #   continueOnError: true
  #   steps:
  #   - task: DotNetCoreInstaller@0
  #     inputs:
  #       version: '2.2.401'
  #     displayName: 'Install Dotnet Core'
  #   - script: |
  #       dotnet test --logger "trx;LogFileName=report.trx"
  #     workingDirectory: $(build.sourcesDirectory)/Services/TicketStore.Api.Tests.Unit
  #     displayName: 'dotnet test'
  #     env:
  #       DOTNET_CLI_TELEMETRY_OPTOUT: true
  #   - script: |
  #       dotnet tool install -g trx2junit
  #       ~/.dotnet/tools/trx2junit TestResults/report.trx
  #     workingDirectory: $(build.sourcesDirectory)/Services/TicketStore.Api.Tests.Unit
  #     displayName: 'prepare JUnit report'
  #   - task: PublishTestResults@2
  #     condition: always()
  #     inputs:
  #       testResultsFormat: 'JUnit' # Options: JUnit, NUnit, VSTest, xUnit, cTest
  #       testResultsFiles: 'TestResults/report.xml' 
  #       searchFolder: '$(build.sourcesDirectory)/Services/TicketStore.Api.Tests.Unit' # Optional

  # - job: Web
  #   pool:
  #     vmImage: 'ubuntu-latest'
  #   continueOnError: true
  #   steps:
  #   - task: DotNetCoreInstaller@0
  #     inputs:
  #       version: '2.2.401'
  #     displayName: 'Install Dotnet Core'
  #   - script: |
  #       dotnet test --logger "trx;LogFileName=report.trx"
  #     workingDirectory: $(build.sourcesDirectory)/Services/TicketStore.Web.Tests.Unit
  #     displayName: 'dotnet test'
  #     env:
  #       DOTNET_CLI_TELEMETRY_OPTOUT: true
  #   - script: |
  #       dotnet tool install -g trx2junit
  #       ~/.dotnet/tools/trx2junit TestResults/report.trx
  #     workingDirectory: $(build.sourcesDirectory)/Services/TicketStore.Web.Tests.Unit
  #     displayName: 'prepare JUnit report'
  #   - task: PublishTestResults@2
  #     condition: always()
  #     inputs:
  #       testResultsFormat: 'JUnit' # Options: JUnit, NUnit, VSTest, xUnit, cTest
  #       testResultsFiles: 'TestResults/report.xml' 
  #       searchFolder: '$(build.sourcesDirectory)/Services/TicketStore.Web.Tests.Unit' # Optional
  #       #mergeTestResults: false # Optional
  #       #failTaskOnFailedTests: false # Optional
  #       #testRunTitle: # Optional
  #       #buildPlatform: # Optional
  #       #buildConfiguration: # Optional
  #       #publishRunAttachments: true # Optional
